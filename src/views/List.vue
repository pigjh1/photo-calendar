<template>
  <div class="userlist" :class="listClassName">
    <filter-item />

    <div class="nodata" v-if="!filterItems.length">
      <img src="@/assets/icon/smileys/expressions.svg" alt="" >
      데이터가 없습니다.
    </div>

    <div class="list" v-if="filterItems.length">
      <list-box v-if="!tableType" />
      <Table v-if="tableType" />
    </div>
  </div>
</template>

<script>
import FilterItem from '@/components/FilterItem';
import ListBox from '@/components/ListBox';
import Table from '@/components/Table';

export default {
  components: {
    FilterItem,
    ListBox,
    Table
  },
  data() {
    return {
      userdata: this.$store.state.userdata,
      window: { width: 0, height: 0 }
    };
  },
  beforeMount() {
    this.$store.commit('setupItem', this.newItems);
  },
  created() {
    window.addEventListener('resize', this.handleResize);
    this.handleResize();
  },
  destroyed() {
    window.removeEventListener('resize', this.handleResize);
  },
  computed: {
    filterItems() {
      return this.$store.getters.filterItems;
    },
    imgType() {
      return this.$store.state.filtering.imgType;
    },
    tableType() {
      return this.$store.state.filtering.tableType;
    },
    filterCollapsed() {
      return this.$store.state.filtering.filterCollapsed;
    },
    listClassName() {
      let className = '';
      if (this.imgType) className = className + 'is-imgtype';
      if (this.filterCollapsed) className = className + 'is-collapsed';
      return className;
    },
    newItems() {
      return this.userdata.map((obj) => {
        const newObj = {};

        newObj.id = obj.id;
        newObj.img = obj.img;
        newObj.cate = obj.cate;
        newObj.title = obj.title;
        newObj.date = obj.date;
        newObj.time = obj.time;
        newObj.actor = obj.actor;
        newObj.place = obj.place;
        newObj.price = obj.price;
        newObj.office = obj.office;
        newObj.datayear = obj.date.replace('-', '').substr(0, 4);

        return newObj;
      });
    }
  },
  methods: {
    handleResize() {
      this.window.width = window.innerWidth;
      this.window.height = window.innerHeight;

      this.$store.commit('changeFilterCollapsed', this.window.width < 769);
    }
  }
};
</script>
